version: '3'

networks:
  app:
    driver: bridge
  nginx-proxy:
    external: true
services:
    app:
        build:
          context: .
          dockerfile: docker/app/Dockerfile
          args:
            - ENV_FILE=.env.dev
        image: ${APP_IMAGE}
        container_name: box3d-front-app
        restart: ${DK_RESTART}
        logging:
          driver: 'json-file'
          options:
            max-file: '5'
            max-size: '100m'
        networks:
          - app
    nginx:
      build:
        context: .
        dockerfile: docker/nginx/Dockerfile
        args:
          - APP_IMAGE=${APP_IMAGE}
      image: ${NGINX_IMAGE}
      container_name: box3d-front-nginx
      logging:
        driver: 'json-file'
        options:
          max-file: '5'
          max-size: '100m'
      restart: ${DK_RESTART}
      networks:
        - app
        - nginx-proxy
      depends_on:
        - app
      environment:
        API_HOST: http://box3d-api-nginx
        ADMIN_HOST: http://box3d-admin
        VIRTUAL_HOST: dev.box3d.com
        VIRTUAL_PORT: 80
    nginx_prod:
      build:
        context: .
        dockerfile: docker/nginx/Dockerfile
        args:
          - APP_IMAGE=${APP_IMAGE}
      image: ${NGINX_IMAGE}
      container_name: box3d-prod-front-nginx
      logging:
        driver: 'json-file'
        options:
          max-file: '5'
          max-size: '100m'
      restart: ${DK_RESTART}
      networks:
        - app
        - nginx-proxy
      depends_on:
        - app
      environment:
        API_HOST: http://box3d-api-nginx
        ADMIN_HOST: http://box3d-admin
        VIRTUAL_HOST: box3d.dev.glob-com.ru
        VIRTUAL_PORT: 80
        LETSENCRYPT_HOST: box3d.dev.glob-com.ru
        LETSENCRYPT_EMAIL: sites.globcom@yandex.ru
